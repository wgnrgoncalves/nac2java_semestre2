-- DROP USER SAITH CASCADE;
-- CREATE USER SAITH IDENTIFIED BY SAITH;
-- GRANT DBA, CONNECT, RESOURCE TO SAITH;
-- COMMIT;



CREATE TABLE TBL_FUNCIONARIO
(	ID NUMBER,
	NOME VARCHAR2(200 BYTE),
	TIPO VARCHAR2(50 BYTE)
);
ALTER TABLE TBL_FUNCIONARIO ADD CONSTRAINT TBL_FUNCIONARIO_PK PRIMARY KEY (ID);
CREATE SEQUENCE TBL_FUNCIONARIO_SEQ MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE ORDER  NOCYCLE;
CREATE OR REPLACE TRIGGER TBL_FUNCIONARIO_TRG BEFORE INSERT ON TBL_FUNCIONARIO
FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
      SELECT TBL_FUNCIONARIO_SEQ.NEXTVAL INTO :NEW.ID FROM DUAL;
    END IF;
END;
/
ALTER TRIGGER TBL_FUNCIONARIO_TRG ENABLE;






CREATE TABLE TBL_PRONTUARIO
(	ID NUMBER,
	DISCRIMINATOR VARCHAR2(50 BYTE),
	DATA DATE,
	OBSERVACOES VARCHAR2(800 BYTE),
	TEMPERATURA NUMBER(4,1),
	PRESSAO VARCHAR2(15 BYTE),
	SATURACAO NUMBER(4,1),
	PACIENTE_ID NUMBER,
	FUNCIONARIO_ID NUMBER
);
ALTER TABLE TBL_PRONTUARIO ADD CONSTRAINT TBL_PRONTUARIO_PK PRIMARY KEY (ID);
CREATE SEQUENCE TBL_PRONTUARIO_SEQ MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE ORDER  NOCYCLE;
CREATE OR REPLACE TRIGGER TBL_PRONTUARIO_TRG BEFORE INSERT ON TBL_PRONTUARIO
FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
      SELECT TBL_PRONTUARIO_SEQ.NEXTVAL INTO :NEW.ID FROM DUAL;
    END IF;
END;
/
ALTER TRIGGER TBL_PRONTUARIO_TRG ENABLE;



CREATE TABLE TBL_PACIENTE
(	ID NUMBER,
	NOME VARCHAR2(200 BYTE),
	TELEFONE VARCHAR2(50 BYTE),
	EMAIL VARCHAR2(50 BYTE),
	CPF NUMBER(14,0),
	RESPONSAVEL VARCHAR2(200 BYTE),
	NASCIMENTO DATE
);
ALTER TABLE TBL_PACIENTE ADD CONSTRAINT TBL_PACIENTE_PK PRIMARY KEY (ID);
CREATE SEQUENCE TBL_PACIENTE_SEQ MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE ORDER  NOCYCLE;
CREATE OR REPLACE TRIGGER TBL_PACIENTE_TRG BEFORE INSERT ON TBL_PACIENTE
FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
      SELECT TBL_PACIENTE_SEQ.NEXTVAL INTO :NEW.ID FROM DUAL;
    END IF;
END;
/
ALTER TRIGGER TBL_PACIENTE_TRG ENABLE;




CREATE TABLE TBL_LEITO
(	ID NUMBER,
	NUMERO VARCHAR2(10 BYTE),
	TIPO VARCHAR2(50 BYTE),
	LIBERACAO DATE,
	STATUS VARCHAR2(50 BYTE)
);
ALTER TABLE TBL_LEITO ADD CONSTRAINT TBL_LEITO_PK PRIMARY KEY (ID);
CREATE SEQUENCE TBL_LEITO_SEQ MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE ORDER  NOCYCLE;
CREATE OR REPLACE TRIGGER TBL_LEITO_TRG BEFORE INSERT ON TBL_LEITO
FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
      SELECT TBL_LEITO_SEQ.NEXTVAL INTO :NEW.ID FROM DUAL;
    END IF;
END;
/
ALTER TRIGGER TBL_LEITO_TRG ENABLE;



CREATE TABLE TBL_INTERNACAO
(	ID NUMBER,
	ENTRADA DATE,
	SAIDA DATE,
	MOTIVO NUMBER,
	PACIENTE_ID NUMBER,
	LEITO_ID NUMBER,
	FUNCIONARIO_ID NUMBER
);
ALTER TABLE TBL_INTERNACAO ADD CONSTRAINT TBL_INTERNACAO_PK PRIMARY KEY (ID);
CREATE SEQUENCE TBL_INTERNACAO_SEQ MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE ORDER  NOCYCLE;
CREATE OR REPLACE TRIGGER TBL_INTERNACAO_TRG BEFORE INSERT ON TBL_INTERNACAO
FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
      SELECT TBL_INTERNACAO_SEQ.NEXTVAL INTO :NEW.ID FROM DUAL;
    END IF;
END;
/
ALTER TRIGGER TBL_INTERNACAO_TRG ENABLE;


ALTER TABLE TBL_PRONTUARIO ADD FOREIGN KEY (PACIENTE_ID) REFERENCES TBL_PACIENTE (ID) ENABLE;
ALTER TABLE TBL_PRONTUARIO ADD FOREIGN KEY (FUNCIONARIO_ID) REFERENCES TBL_FUNCIONARIO (ID) ENABLE;
ALTER TABLE TBL_INTERNACAO ADD FOREIGN KEY (PACIENTE_ID) REFERENCES TBL_PACIENTE (ID) ENABLE;
ALTER TABLE TBL_INTERNACAO ADD FOREIGN KEY (LEITO_ID) REFERENCES TBL_LEITO (ID) ENABLE;
ALTER TABLE TBL_INTERNACAO ADD FOREIGN KEY (FUNCIONARIO_ID) REFERENCES TBL_FUNCIONARIO (ID) ENABLE;

ALTER TABLE TBL_FUNCIONARIO ADD LOGIN VARCHAR(45) NOT NULL;
ALTER TABLE TBL_FUNCIONARIO ADD SENHA VARCHAR(45) NOT NULL;
ALTER TABLE TBL_FUNCIONARIO ADD CONSTRAINT TBL_FUNCIONARIO_UK UNIQUE (TBL_FUNCIONARIO);

